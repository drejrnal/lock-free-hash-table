## 概述

哈希结构的性能影响因素
- 线程安全哈希结构中，哈希函数的选择影响哈希桶内数据的分布，从而影响桶在锁获取时的竞争程度，进而影响性能
- 垃圾回收机制：使用folly库中的hazard pointer模块

## 实验结果对比

下述实验在2个NUMA节点，20个cores，40个线程的单机进行测试

### 哈希表插入-Lock-free实现方式与Folly lock-based实现方式对比

|                          | 8 threads             | 16 threads            |
| ------------------------ | --------------------- | --------------------- |
| lock based insertion     | 428ms, 2.33Mops       | 482ms, 2.07Mops       |
| lock free insertion      | 262ms, 3.81Mops       | 153ms, 6.51Mops       |

从上表中看出，**lock free insertion的实现方式相比于lock based，性能更好，且具有较好的可扩展性。**

### 并发混合操作下，Lock free实现方式的性能对比

多线程场景下，并发执行插入、删除、查找操作，每种操作各自执行100 0000次。

|          | 8 threads           | 16 threads          | 32 threads          |
| -------- | ------------------- | ------------------- | ------------------- |
| 性能     | 930ms, 1.07Mops     | 629 ms, 1.59Mops    | 482ms, 2.07Mops     |

从该表看出，lock free实现方式具有较好的可扩展性。该实验在本机macbook上测试，8线程情况下，需要1800ms左右，吞吐率性能较上表比，下降了将近一半。
